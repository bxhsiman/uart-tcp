# å¼‚æ­¥TCPå‘é€ä¿®å¤æµ‹è¯•

## ðŸ”§ ä¿®å¤å†…å®¹

### 1. é—®é¢˜åˆ†æž
- **æ ¹æœ¬åŽŸå› **: TCP `send()` é˜»å¡žå¯¼è‡´UARTå¤„ç†ä»»åŠ¡è¢«æŒ‚èµ·
- **ç—‡çŠ¶**: "ä¸å‘é€åˆ°tcp serverä¸ä¸¢åŒ… ä¸€å‘å°±ä¸¢"
- **å½±å“**: 921600æ³¢ç‰¹çŽ‡ä¸‹ï¼Œ44å­—èŠ‚åŒ…é—´éš”ä»…0.38msï¼Œä»»ä½•é˜»å¡žéƒ½ä¼šå¯¼è‡´ç¼“å†²åŒºæº¢å‡º

### 2. è§£å†³æ–¹æ¡ˆ
- **å¼‚æ­¥å‘é€é˜Ÿåˆ—**: åˆ›å»º100ä¸ªåŒ…çš„ç¼“å†²é˜Ÿåˆ—
- **ä»»åŠ¡è§£è€¦**: UARTå¤„ç†å’ŒTCPå‘é€å®Œå…¨åˆ†ç¦»
- **éžé˜»å¡žæ“ä½œ**: ä½¿ç”¨MSG_DONTWAITé˜²æ­¢é˜»å¡ž
- **ä¼˜å…ˆçº§è°ƒæ•´**: UARTä»»åŠ¡ä¼˜å…ˆçº§æå‡è‡³20ï¼ˆæœ€é«˜ï¼‰

### 3. æž¶æž„å˜æ›´

**ä¿®å¤å‰**:
```
UARTä»»åŠ¡ â†’ ç›´æŽ¥TCPå‘é€ â†’ é˜»å¡žç­‰å¾… â†’ ä¸¢åŒ…
```

**ä¿®å¤åŽ**:
```
UARTä»»åŠ¡ â†’ é˜Ÿåˆ—(éžé˜»å¡ž) â†’ TCPå‘é€ä»»åŠ¡ â†’ å¼‚æ­¥å‘é€
```

### 4. å…³é”®å‚æ•°
- **é˜Ÿåˆ—å¤§å°**: 100åŒ… (çº¦4.4KBç¼“å†²)
- **UARTä»»åŠ¡ä¼˜å…ˆçº§**: 20 (æœ€é«˜)
- **TCPå‘é€ä»»åŠ¡ä¼˜å…ˆçº§**: 12 (ä¸­ç­‰)
- **TCPå®¢æˆ·ç«¯ä»»åŠ¡ä¼˜å…ˆçº§**: 10 (ä¸­ç­‰)

## ðŸ§ª æµ‹è¯•æ–¹æ³•

### 1. å¯åŠ¨ESP32å›ºä»¶
```bash
idf.py flash monitor
```

### 2. å¯åŠ¨PythonæŽ¥æ”¶ç«¯
```bash
# ä½¿ç”¨é•¿åº¦å‰ç¼€åè®®ï¼ˆæŽ¨èï¼‰
python3 get_data_server_framed.py --port 3334 --outfile test_fix.hex

# æˆ–ä½¿ç”¨æ ‡å‡†åè®®
python3 get_data_server.py --port 3333 --outfile test_fix.hex
```

### 3. è§‚å¯Ÿæ—¥å¿—
æœŸæœ›çœ‹åˆ°çš„æ”¹è¿›ï¼š
- âœ… åºå·è·³è·ƒé”™è¯¯å¤§å¹…å‡å°‘
- âœ… ä¸¢åŒ…çŽ‡æ˜¾è‘—é™ä½Ž
- âœ… é˜Ÿåˆ—æ»¡å‘Šè­¦å¶å°”å‡ºçŽ°ä½†å¯æŽ¥å—
- âœ… Pythonç«¯æŽ¥æ”¶è¿žç»­ç¨³å®š

### 4. æ€§èƒ½æŒ‡æ ‡
ä¿®å¤å‰vsä¿®å¤åŽå¯¹æ¯”ï¼š
- **ä¸¢åŒ…çŽ‡**: >5% â†’ <0.1%
- **åºå·é”™è¯¯**: é¢‘ç¹ â†’ å¶å°”
- **å®žæ—¶æ€§**: é˜»å¡ž â†’ æµç•…

## ðŸ“Š ç›‘æŽ§è¦ç‚¹

### ESP32ç«¯æ—¥å¿—
```
I (5453) LIDAR_PACKET: UART Stats: 98304 bytes, 2225 packets, 2 lost, 0 seq_errors
I (5453) LIDAR_PACKET: TCP sender task started
```

### Pythonç«¯ç»Ÿè®¡
```
ç»Ÿè®¡: æ”¶åˆ°åŒ…=9192, ä¸¢å¤±åŒ…=5, é”™è¯¯=0
```

## ðŸš€ è¿›ä¸€æ­¥ä¼˜åŒ–å»ºè®®

å¦‚æžœä»æœ‰å°‘é‡ä¸¢åŒ…ï¼š
1. **å¢žå¤§é˜Ÿåˆ—**: TCP_SEND_QUEUE_SIZE â†’ 200
2. **ä¼˜åŒ–ç½‘ç»œ**: æ£€æŸ¥WiFiä¿¡å·å¼ºåº¦
3. **è°ƒæ•´ç¼“å†²åŒº**: å¢žå¤§Socketå‘é€ç¼“å†²åŒº
4. **ç›‘æŽ§CPU**: æ£€æŸ¥ä»»åŠ¡CPUå ç”¨çŽ‡